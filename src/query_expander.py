# query_expander.py
from typing import Dict, List

class QueryExpander:
    """Расширитель запросов для улучшения поиска"""

    def __init__(self):
        # ключи — то, что реально встречается в запросах
        self.synonyms: Dict[str, List[str]] = {
            "номер счета": [
                "номер счета", "счет", "счёт", "расчетный счет",
                "банковский счет", "р/с", "расчетный счёт"
            ],
            "номер карты": [
                "номер карты", "карта", "банковская карта", "пластиковая карта"
            ],
            "кредитная карта": [
                "кредитная карта", "кредитной карте", "кредитки",
                "кредитка", "карта кредитная"
            ],
            "дебетовая карта": [
                "дебетовая карта", "дебетовой карте", "дебетовая",
                "карта дебетовая"
            ],
            "пин код": [
                "пин код", "pin-код", "pin код", "pin", "пин", "код карты"
            ],
            "смс": [
                "смс", "sms", "смс уведомления", "смс-уведомления",
                "смс оповещения", "sms-уведомления", "смс информирование"
            ],
            "смс код": [
                "смс код", "код из смс", "код подтверждения",
                "одноразовый код", "проверочный код", "sms-код"
            ],
            "альфа чек": [
                "альфа чек", "альфачек", "услуга альфа чек",
                "смс информирование", "смс уведомления", "смс оповещения"
            ],
            "альфачек": [  # отдельный ключ на всякий случай
                "альфачек", "альфа чек", "услуга альфа чек",
                "смс информирование", "смс уведомления", "смс оповещения"
            ],
            "сбп": [
                "сбп",
                "система быстрых платежей",
                "быстрые платежи",
                "перевод через систему быстрых платежей",
                "перевод по номеру телефона"
            ],
            "кэшбэк": [
                "кэшбэк", "кэшбек", "cashback", "кэшбэк по карте"
            ],
            "кэшбек": [
                "кэшбек", "кэшбэк", "cashback", "кэшбэк по карте"
            ],
        }

    def expand_query(self, query: str) -> str:
        original_query = query.lower()
        expanded_terms = [original_query]

        for term, synonyms in self.synonyms.items():
            variants = [term] + synonyms
            if any(v in original_query for v in variants):
                expanded_terms.extend(synonyms)

        unique_terms = list(dict.fromkeys(expanded_terms))
        return " ".join(unique_terms)



